from dataclasses import dataclass

from phe import paillier

from poll.cipher.base import CipherBase


n = 3113951933042548443083669553826920792421834986297932222571090481383435811271704236256168899707031294756998560130006375146606332681178191700415679302992285142191114390188866875036848868979589295347080008828087129625524509447720471560858784529512645927473522837741439001995764238665442644119151820589292821554534340404992634925645467033454118600358873632068117885814491269574483076146317630660752727033950995252522268928152348340186891994313449018748547813181368723408089747622628072648269799233084862461331716944559985230618697672551600690728067265940620452005407527130209619561502157439219153132821970787985041805611907308796394125762051763510610475245616573830520269517395621647922385138395937723523552531393467619265026025791455636733425553402916888028474883350738032828788557392668786978743767185273949581365579534775876880386759728548827770358891285298150385129435516549556418040744389713652968148935887714006068849077571
p = 1434626449411581253708683870345415355624137951181935449560036836423180486723555524354324464532883115450671737902339518760166617690579481453088179550572203630640653774444526329440237446486307469158791440357619870810706999668367866512231642970278596207142479102063245432106681959597714913085972381110166904566834768843073605432920355408726001158843832779211894727502310534499195928319633186503446670823580082946156979777807837321317862989640094352993723506333985157
q = 2170566375881157348466387052615873928100382228375042115730796783357367934042165061561732832660177472624802079409440651603000410901680274073476137557586315010620346709383804143795360184474264254665756136074324800557018591008152718035731429633196437492198110347254872965830307759884058398611459854612617376120540608160149677767932965729149200918800386887592322413829211218255871566403897282226275659749542747878402535614388577018436017368958800312526801377686475303

pub_key = paillier.PaillierPublicKey(n=n)
private_key = paillier.PaillierPrivateKey(pub_key, p, q)


@dataclass
class PaillierCipher(CipherBase):
    def encrypt(self, id_: int, plaintext: int, nonce: bytes) -> int:
        return pub_key.encrypt(plaintext)

    def decrypt_sum(self, start_id: int, end_id: int, ciphertext: int, nonce: bytes) -> int:
        return private_key.decrypt(ciphertext)
